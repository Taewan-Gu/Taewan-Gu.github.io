---
sidebar_position: 8
description: 파이썬 클린코드 챕터 8 요약
---

# Ch.08 단위 테스트와 리팩토링

:::note
프로그래밍 테스트에는 여러 테스트가 있지만, 통합 테스트와 단위 테스트가 제일 유명하고 자주 쓰인다. 그 중 단위 테스트에 대하여 알아본다.
:::

<br/>

## 단위 테스트의 특징

* 격리
  * 외부 시스템과 독립(DB, 외부 API 등)
  *  비즈니스 로직에만 집중
  * 이전 상태와 관계없이 임의의 순서로 실행될 수 있음을 보증
* 성능
  * 빠른 속도
  * 반복적으로 실행 가능하게 설계
* 반복 가능성
  * 테스트의 결과는 규칙적(예를 들어, 10번 테스트를 했을 때, 3번 성공, 7번 실패 같은 코드는 없어야 한다)
* 자체 검증
  * 테스트의 실행만으로 결과를 결정할 수 있도록 설계(즉, 테스트를 위한 추가단계가 없어야 함)

<br/>

## 단위 테스트 경계

테스트를 할 때, 우리가 짠 코드만을 테스트하도록 해야한다. 외부 라이브러리의 의존성에 대한 테스트까지 할 필요는 없다. 하지만 특별한 상황에서는 그럴 수도 있으니 상황에 맞게, 각 팀에 맞게 테스트 경계를 정하고 해당 테스트의 목적을 명확하게 하여 테스트 코드를 짜야한다.

<br/>

## 단위 테스트 도구

책에서는 unittest, pytest 를 소개해준다. FastAPI에서는 TestClient 를 직접지원해주기 때문에 해당 라이브러리를 사용하면 되고, 해당 라이브러리는 pytest를 기반으로 만들어졌다.

<br/>

## 테스트 더블 객체 정리

**Mock**

* 실제 구현이 없다.
* 행동에 대한 테스트를 할 수 있다.

**Stub**

* 실제로 구현해야하고, 로직이 없는 깡통 객체를 만들어서 테스트한다.
* 행동에 대한 테스트를 할 수 없다.(상태 체크만 가능)

**Spy**

* 실제로 구현해야하고, 실제 객체나 Stub 객체 중 요청할 객체를 골라 라우팅해준다.
* 행동에 대한 테스트를 할 수 있다고 하는데 테스트 툴에 따라 다를 듯 하다.



이 중 Mock 을 가장 자주 쓰는 이유는 행동에 대한 테스트를 할 수 있고 실제 구현 없이 각 테스트에 맞게 용이하게 할 수 있기 때문이다.

다만, 각 테스트 툴의 구현체에 따라 조금씩 다를 수 있으므로 해당 테스트 툴의 공식문서를 참고해야 한다. 

<br/>

## TDD

실용적인 관점에서 코드를 볼 수 있으며 기본적인 기능 테스트를 누락할 가능성이 낮아지기 때문에 이러한 TDD 방법론이 생겼다.

**테스트 주도 개발 3단계**

1. 구현할 내용을 단위 테스트로 작성
   * 이는 아직 존재하지 않는 새로운 기능이거나 결함이 있는 기존 코드일 수 있다.
   * 현재는 테스트를 통과하지 못 한다.
2. 해당 조건을 충족시키는 최소한의 코드 구현
   * 이제는 테스트를 통과해야 한다.
3. 리팩토링을 통한 코드 개선
   * 개선 후, 계속 테스트가 통과하는지 확인한다.

<br/>
